/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","fin/gl/glview/display/util/Status","fin/gl/glview/display/util/Formatter","sap/ui/generic/app/navigation/service/NavigationHandler","sap/ui/generic/app/navigation/service/SelectionVariant","sap/ui/generic/app/navigation/service/NavType","sap/ui/core/IconPool","sap/ui/core/ListItem","sap/m/MessageBox"],function(C,J,S,F,N,a,b,I,L,M){"use strict";return C.extend("fin.gl.glview.display.controller.Main",{entitySetF4L:"/I_Ledger",sLeadingLedger:"",entitySetF4ERT:"/I_ExchangeRateType",aExRateSuggestionItems:[],bIsExRateRequestTriggered:false,entitySetF4DC:"/I_Currency",aDispCurSuggestionItems:[],bIsDispCurRequestTriggered:false,textBundle:{},oStatus:{},oNavigationHandler:{},oShareActionSheet:null,bIsControllerInitialized:false,bIsMetadataLoaded:false,bIsFilterBarInitialized:false,bIsLeadingLedgerFetchedAlready:false,bIsSFBTriggeredDueToInitialization:false,bIsSTBTriggeredDueToInitialization:false,bIsInitialSearchTriggered:false,bIsPreviousSearchTriggeredBeforeNavWasEvaluated:false,bIsSearchValid:true,bIsCurrentSearchGrouped:true,bIsPossibleErrorTriggeredByUser:true,oMessagePopover:"",oCustomErrorMessages:[],oAvailableCurrencies:{},oRowDetailsPopover:"",oRowContext:"",onBeforeRendering:function(){var c="sapUiSizeCozy",s="sapUiSizeCompact",d="sapUiSizeCondensed";if(jQuery(document.body).hasClass(s)||this.getOwnerComponent().getContentDensityClass()===s){this.getView().byId("fin.gl.glview.display.smarttable").addStyleClass(d);}else if(jQuery(document.body).hasClass(c)||this.getOwnerComponent().getContentDensityClass()===c){this.getView().byId("fin.gl.glview.display.smarttable").addStyleClass(c);}},onInit:function(){this.getView().setBusy(true);this.textBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oNavigationHandler=new N(this);this.getView().byId("fin.gl.glview.display.smarttable").attachShowOverlay(function(e){if(!this.bIsInitialSearchTriggered){e.getParameter("overlay").show=false;}}.bind(this));this.getView().byId("fin.gl.glview.display.smarttable").attachDataReceived(function(e){e.getSource().setShowRowCount(true);});this.oStatus=new fin.gl.glview.display.util.Status.StatusOpen(this);this._toggleControllingAreaVisibility(this);this.getView().byId("fin.gl.glview.display.sfb.KDpicker").setDateValue(new Date());this.getView().byId("fin.gl.glview.display.sfb.ExRateDatePicker").setDateValue(new Date());this.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput").setValue("M");this.getOwnerComponent().getModel().attachRequestCompleted(function(e){if(e.getParameter("url").indexOf("C_JournalEntryItemBrowser")!==-1){var t=this.getView().byId("fin.gl.glview.display.analyticaltable");t.setShowOverlay(false);this._setDetailsButttonEnablement(t);}if(e.getParameter("success")===false){if(e.getParameter("url").indexOf("C_JournalEntryItemBrowser")!==-1){if(!e.getParameter("response")||(e.getParameter("response")&&e.getParameter("response").statusText!=="abort")){this.getView().byId("fin.gl.glview.display.smarttable").setBusy(false);var T=this.getView().byId("fin.gl.glview.display.analyticaltable");T.setEnableBusyIndicator(false);T.setBusy(false);}}if((e.getParameter("response"))&&(e.getParameter("response").statusText!=="abort")&&(this.bIsPossibleErrorTriggeredByUser)){this._handleMessaging();}return;}}.bind(this));var p=new J();p.setProperty("/headerExpanded",true);p.setProperty("/numberOfMessages",0);this.getView().setModel(p,"page");this.oMessagePopover=new sap.m.MessagePopover({items:{path:"messaging>/",template:new sap.m.MessagePopoverItem({description:"{messaging>message}",type:"{messaging>type}",title:"{messaging>code}"})}});this.getView().setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"message");var m=new J();m.setData(this.getView().getModel("message").getData());this.oMessagePopover.setModel(m,"messaging");this.getView().setModel(m,"messaging");this.getOwnerComponent().getModel().getMetaModel().loaded().then(function(){this.bIsMetadataLoaded=true;if(!this.getOwnerComponent().getModel().getMetaModel().getODataEntitySet("I_LedgerCompanyCodeVH")){var c=this.getOwnerComponent().getModel().getMetaModel().getMetaContext("/C_JournalEntryItemBrowserResults/CompanyCode");this.oCompanyCodeEntitySetPromise=this.getOwnerComponent().getModel().getMetaModel().getODataValueLists(c);}this.initAppState();}.bind(this));this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this._setGroupHeaderFormatter();this.oAvailableCurrencies=sap.ui.getCore().getConfiguration().getFormatSettings().getCustomCurrencies();if(this.extHookOnInit){this.extHookOnInit();}this.bIsControllerInitialized=true;},_handleMessaging:function(){var m=this.getView().getModel("message");var o=this.getView().getModel("messaging");var c=m.getData();var d=[];var l=c.length-1;for(var i=l;i>-1;i--){if(((c[i].message.indexOf("An exception was raised")!==-1)&&!c[i].description)||(!c[i].message&&!c[i].description)||(c[i].target.indexOf("I_FiscalCalendarDtePrevPeriods")!==-1)){c.splice(i,1);}else{d.push({code:c[i].code,type:c[i].type,message:this.textBundle.getText("ERROR_MES",[c[i].message,decodeURIComponent(c[i].target)])});}}for(var x=0;x<this.oCustomErrorMessages.length;x++){d.push({code:this.oCustomErrorMessages[x].code,type:this.oCustomErrorMessages[x].type,message:this.oCustomErrorMessages[x].message});}o.setData(d);this.getView().getModel("page").setProperty("/numberOfMessages",d.length);},onAfterRendering:function(){},onInitFilterBar:function(e){var s=this.getView().byId("fin.gl.glview.display.smartfilterbar");var f=s.determineFilterItemByName("PostingDate");if(f){f.setVisible(true);f.setVisibleInFilterBar(false);}f=s.determineFilterItemByName("ClearingDate");if(f){f.setVisible(true);f.setVisibleInFilterBar(false);}this._setDefaultLedgerInUI(this);this.bIsFilterBarInitialized=true;this.initAppState();},initAppState:function(){var A={};var u={};var n="";if(jQuery.sap.getUriParameters().get("responderOn")&&jQuery.sap.getUriParameters().get("parametersProvided")){var s='{"Version":{"Major":"1","Minor":"0","Patch":"0"},"SelectionVariantID":"","Text":"Selection Variant with ID ",'+'"ODataFilterExpression":"","Parameters":[],"SelectOptions":'+'[{"PropertyName":"ControllingArea","Ranges":[{"Sign":"I","Option":"EQ","Low":"'+jQuery.sap.getUriParameters().get("ControllingArea")+'","High":null}]},'+'{"PropertyName":"ProfitCenter","Ranges":[{"Sign":"I","Option":"EQ","Low":"'+jQuery.sap.getUriParameters().get("ProfitCenter")+'","High":null}]}]}';var o=new a(s);A={bNavSelVarHasDefaultsOnly:false,oDefaultedSelectionVariant:{_mParameters:{},_mSelectOptions:{},_sId:""},oSelectionVariant:o,selectionVariant:o.toJSONString()};u={ControllingArea:[jQuery.sap.getUriParameters().get("ControllingArea")],ProfitCenter:[jQuery.sap.getUriParameters().get("ProfitCenter")]};n="URLParams";}this.getView().setBusy(false);this.getView().setBusy(true);if(!this.bIsMetadataLoaded||!this.bIsControllerInitialized||!this.bIsFilterBarInitialized||!this.bIsLeadingLedgerFetchedAlready){return;}this.getView().setBusy(false);var p=this.oNavigationHandler.parseNavigation();p.done(function(c,U,d){if(!this.getOwnerComponent().getModel().getMetaModel().getODataEntitySet("I_LedgerCompanyCodeVH")){this.oCompanyCodeEntitySetPromise.then(function(){if(jQuery.sap.getUriParameters().get("responderOn")&&jQuery.sap.getUriParameters().get("parametersProvided")){this.handleNavigation(A,u,n,true);}else{this.handleNavigation(c,U,d);}}.bind(this));}else{if(jQuery.sap.getUriParameters().get("responderOn")&&jQuery.sap.getUriParameters().get("parametersProvided")){this.handleNavigation(A,u,n,true);}else{this.handleNavigation(c,U,d);}}}.bind(this));p.fail(function(e){this.oCustomErrorMessages.push({code:this.textBundle.getText("INBOUND_NAV_ERROR"),type:"Error",message:this.textBundle.getText("INBOUND_NAV_ERROR")});this.onMessagePopoverPressed(this.getView().byId("fin.gl.glview.display.footer.button.alert"));}.bind(this));},_handleSelectionVariant:function(A,s,h,u){var o=A;var U=u;o.selectionVariant=JSON.stringify(this._formatSelectionVariant(JSON.parse(o.selectionVariant)));var c=new a(o.selectionVariant);var d={};if(o.semanticDates&&(typeof o.semanticDates==="string")){d=JSON.parse(o.semanticDates);}var e=new sap.ui.comp.state.UIState({selectionVariant:JSON.parse(o.selectionVariant),semanticDates:d});var m={replace:true,strictMode:false};var f=c.getParameterNames().concat(c.getSelectOptionsPropertyNames());if(!h||s.isCurrentVariantStandard()){for(var k=0;k<f.length;k++){s.addFieldToAdvancedArea(f[k]);}s.clearVariantSelection();s.clear();s.setUiState(e,m);if(s.getFilterData()&&!s.getFilterData().Ledger){this._setDefaultLedgerInUI(this);}}if((c.getSelectOption("SelectUserDefaultLayoutVariant")!==undefined&&(c.getSelectOption("SelectUserDefaultLayoutVariant")[0].Low===true||c.getSelectOption("SelectUserDefaultLayoutVariant")[0].Low==="true"))||(c.getParameter("SelectUserDefaultLayoutVariant")!==undefined&&(c.getParameter("SelectUserDefaultLayoutVariant")===true||c.getParameter("SelectUserDefaultLayoutVariant")==="true"))){U=true;}if((c.getSelectOption("SelectOnlyOIMAccounts")!==undefined&&(c.getSelectOption("SelectOnlyOIMAccounts")[0].Low===false||c.getSelectOption("SelectOnlyOIMAccounts")[0].Low==="false"))||(c.getParameter("SelectOnlyOIMAccounts")!==undefined&&(c.getParameter("SelectOnlyOIMAccounts")===false||c.getParameter("SelectOnlyOIMAccounts")==="false"))){o.customData.IsOpenItemManagedFlag="DDLB_INCLUDE";}if(c.getSelectOption("DisplayCurrency")!==undefined&&c.getSelectOption("DisplayCurrency")[0].Low!==undefined){o.customData.DisplayCurrency=c.getSelectOption("DisplayCurrency")[0].Low;}else if(c.getParameter("DisplayCurrency")!==undefined){o.customData.DisplayCurrency=c.getParameter("DisplayCurrency");}var g=c.getSelectOption("SelectForOpenAtKeydate");if(g!==undefined&&g[0].Option==="EQ"&&g[0].Low){o.customData.ItemStatus="Open";o.customData.KeyDate=g[0].Low;}return{oAppData:o,bUseUserDefinedTableVariant:U};},handleNavigation:function(A,u,n,c){if(n===b.initial){return;}var s=this.getView().byId("fin.gl.glview.display.smartfilterbar");var h=A&&A.bNavSelVarHasDefaultsOnly;var U=false;var o=A||{};o.customData=A.customData||{};if(h){o.customData.ItemStatus=this.oStatus.getCustomFields().status;}if(n===b.xAppState&&o.useNavKeyFormat===true){this.bIsSFBTriggeredDueToInitialization=true;s.setCurrentVariantId("*standard*");var f=this._getFilterDataFromNavKeyFormat(o);s.setFilterData(f,true);o.customData.ItemStatus="All";var d=[];for(var i in f){if(i&&f[i]){d.push([i,f[i]]);}}for(var j=0;j<d.length;j++){if((d[j][0]!=="_CUSTOM")&&(d[j][0]!=="sap-ushell-defaultedParameterNames")){s.addFieldToAdvancedArea(d[j][0]);}}}else if(o.selectionVariant){var r=this._handleSelectionVariant(o,s,h,U);o=r.oAppData;U=r.bUseUserDefinedTableVariant;}var e=this.getView().byId("fin.gl.glview.display.smarttable");if(o.tableVariantId){this.bIsSTBTriggeredDueToInitialization=true;e.setCurrentVariantId(o.tableVariantId);}else if((n===b.iAppState||n===b.xAppState||n===b.URLParams)&&!U&&(!h||o.useNavKeyFormat===true)){this.bIsSTBTriggeredDueToInitialization=true;e.setCurrentVariantId("*standard*");}if(o.customData.SmartTableState&&o.customData.SmartTableState.isTableVariantDirty&&o.customData.SmartTableState.tablePresentationVariant){var g=new sap.ui.comp.state.UIState({selectionVariant:JSON.parse(o.customData.SmartTableState.tableSelectionVariant),presentationVariant:JSON.parse(o.customData.SmartTableState.tablePresentationVariant)});e.setUiState(g);}if((n===b.iAppState||n===b.xAppState||n===b.URLParams)&&(!h||o.useNavKeyFormat===true)){if(!o.customData.ItemStatus){o.customData.ItemStatus="All";}this.restoreCustomAppStateData(o.customData,s);}else{if((o.customData.DisplayCurrency||o.customData.DisplayCurrency==="")&&(this.isFieldInFilterItems(s,"DisplayCurrency"))){this.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput").setValue(o.customData.DisplayCurrency);}}if((!h||o.useNavKeyFormat===true)&&(!c)){if(s.isPending()){this.getView().setBusy(true);var k=function(){this.getView().setBusy(false);if(!this.bIsInitialSearchTriggered||this.bIsPreviousSearchTriggeredBeforeNavWasEvaluated){this.getView().setBusy(true);s.search();s.detachPendingChange(k);}}.bind(this);s.attachPendingChange(k);}else{s.search();}}},_readLeadingLedgerFromBackend:function(c){var m=jQuery.Deferred();var o=c;this.getView().getModel().read(this.entitySetF4L,{urlParameters:{},success:function(d){for(var i=0;i<d.results.length;i++){var e=d.results[i].IsLeadingLedger;if(e==="X"||e===true){o.sLeadingLedger=d.results[i].Ledger;}}m.resolve(o.sLeadingLedger);},error:function(e){jQuery.sap.log.error("Leading Ledger could not be determined via oData");if(e&&e.response){jQuery.sap.log.info(e.response.statusText);}if(e){jQuery.sap.log.info(e.message);}m.reject(e);}});return m.promise();},_setDefaultLedgerInUI:function(c){var s=c.getView().byId("fin.gl.glview.display.smartfilterbar");if(c.sLeadingLedger===""){var p=this._readLeadingLedgerFromBackend(c);p.done(function(l){if(s.getFilterData()&&!s.getFilterData().Ledger){s.setFilterData({"Ledger":l},false);}if(!this.bIsLeadingLedgerFetchedAlready){this.bIsLeadingLedgerFetchedAlready=true;this.initAppState();}}.bind(this));}else{if(s.getFilterData()&&!s.getFilterData().Ledger){s.setFilterData({"Ledger":c.sLeadingLedger},false);}}},_readExchangeRateTypesFromBackend:function(c){var m=jQuery.Deferred();var o=c;this.getView().getModel().read(this.entitySetF4ERT,{urlParameters:{},success:function(d){var e=[];for(var i=0;i<d.results.length;i++){var s="fin.gl.glview.display.smartfilterbar.exRate.sugItem"+i;var f=new L(s,{key:d.results[i].ExchangeRateType,text:d.results[i].ExchangeRateType,additionalText:d.results[i].ExchangeRateType_Text});e.push(f);}o.aExRateSuggestionItems=e;m.resolve(o.aExRateSuggestionItems);},error:function(e){jQuery.sap.log.error("Exchange Rate Type suggestions could not be determined via oData");if(e&&e.response){jQuery.sap.log.info(e.response.statusText);}if(e){jQuery.sap.log.info(e.message);}m.reject(e);}});return m.promise();},_fillExchangeRateSuggestions:function(c){var e=c.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput");if(c.aExRateSuggestionItems.length===0){var p=this._readExchangeRateTypesFromBackend(c);p.done(function(E){e.removeAllSuggestionItems();for(var n=0;n<E.length;n++){e.addSuggestionItem(E[n]);}});}else{e.removeAllSuggestionItems();for(var n=0;n<c.aExRateSuggestionItems.length;n++){e.addSuggestionItem(c.aExRateSuggestionItems[n]);}}},_readDisplayCurrenciesFromBackend:function(c){var m=jQuery.Deferred();var o=c;this.getView().getModel().read(this.entitySetF4DC,{urlParameters:{},success:function(d){var D=[];for(var i=0;i<d.results.length;i++){var s="fin.gl.glview.display.smartfilterbar.dispCur.sugItem"+i;var e=new L(s,{key:d.results[i].Currency,text:d.results[i].Currency,additionalText:d.results[i].Currency_Text});D.push(e);}o.aDispCurSuggestionItems=D;m.resolve(o.aDispCurSuggestionItems);},error:function(e){jQuery.sap.log.error("Display Currency suggestions could not be determined via oData");if(e&&e.response){jQuery.sap.log.info(e.response.statusText);}if(e){jQuery.sap.log.info(e.message);}m.reject(e);}});return m.promise();},_fillDisplayCurrencySuggestions:function(c){var d=c.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput");if(c.aDispCurSuggestionItems.length===0){var p=this._readDisplayCurrenciesFromBackend(c);p.done(function(D){d.removeAllSuggestionItems();for(var n=0;n<D.length;n++){d.addSuggestionItem(D[n]);}});}else{d.removeAllSuggestionItems();for(var n=0;n<c.aDispCurSuggestionItems.length;n++){d.addSuggestionItem(c.aDispCurSuggestionItems[n]);}}},_toggleControllingAreaVisibility:function(c){var o=c.getView().byId("fin.gl.glview.display.smartfilterbar").getControlConfiguration()[0];var A=this.getOwnerComponent().getMetadata().getManifest()["sap.app"].applicationVersion.version;if(!jQuery.sap.getUriParameters().get("responderOn")&&!jQuery.sap.getUriParameters().get("parametersProvided")){if((A.indexOf("11.",0)===0)&&(A.indexOf("SNAPSHOT")===-1)&&(o.getKey()==="ControllingArea")){o.setVisible(false);}}},_convToFilterDate:function(i){if(i!==null&&i!==undefined){var d=new Date(i);var m=d.getMonth()+1;if(m<10){m="0"+m;}var c=d.getDate();if(c<10){c="0"+c;}return d.getFullYear()+"-"+m+"-"+c+"T00:00:00Z";}else{return"";}},_formatIcon:function(A,i,c){if(A){if(i==="X"||i===true){if(c!==null){return I.getIconURI("status-positive");}else{return I.getIconURI("status-error");}}else{return I.getIconURI("accept");}}else{return null;}},_formatIconTooltip:function(A,i,c){if(A){if(i==="X"||i===true){if(c!==null){return this.textBundle.getText("IT_CLEARED");}else{return this.textBundle.getText("IT_OPEN");}}else{return this.textBundle.getText("IT_POSTED_NEW");}}else{return"";}},_formatIconColor:function(A,i,c){if(A){if(i==="X"||i===true){if(c!==null){return sap.ui.core.theming.Parameters.get("sapUiPositiveText");}else{return sap.ui.core.theming.Parameters.get("sapUiNegativeText");}}else{return sap.ui.core.theming.Parameters.get("sapUiPositiveText");}}else{return"";}},_formatDate:function(d){if(d===null||d===undefined){return"";}else{var f=sap.ui.core.format.DateFormat.getDateInstance({style:"medium"});return f.format(new Date(d),true);}},_formatScale:function(c){if(this.oAvailableCurrencies&&(this.oAvailableCurrencies[c]!==undefined)&&(this.oAvailableCurrencies[c].digits>3)){return this.oAvailableCurrencies[c].digits;}else{return 3;}},_formatNoI:function(n){if(n===null||n===undefined){return"";}else{var f=sap.ui.core.format.NumberFormat.getInstance();return f.format(n);}},_formatAsset:function(m,f){if(m===null||m===undefined||m===""){return"";}else{return m+" | "+f;}},_formatOrderTargets:function(c){if(c==="01"){return["InternalOrder"];}else{return[];}},_formatIDTEXT:function(i,t){if(i===null||i===undefined||i===""){return"";}else if(t===null||t===undefined||t===""){return i;}else{return i+" ("+t+")";}},_formatToggleButtonText:function(v){return v?this.textBundle.getText("TITLE_HIDE_FILTERS"):this.textBundle.getText("TITLE_SHOW_FILTERS");},_formatErrorMessage:function(m,d,u){var D="";if(d){D=d;}return m+this.textBundle.getText("ER_REQ_DETAIL")+D+this.textBundle.getText("ER_REQ")+decodeURIComponent(u);},_setGroupHeaderFormatter:function(){var p="fin.gl.glview.display.analyticaltable";if(this.byId(p+".PostingDate")!==undefined){this.byId(p+".PostingDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".DocumentDate")!==undefined){this.byId(p+".DocumentDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".ClearingDate")!==undefined){this.byId(p+".ClearingDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".ExchangeRateDate")!==undefined){this.byId(p+".ExchangeRateDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".CreationDate")!==undefined){this.byId(p+".CreationDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".AssetValueDate")!==undefined){this.byId(p+".AssetValueDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".SettlementReferenceDate")!==undefined){this.byId(p+".SettlementReferenceDate").setGroupHeaderFormatter(this._formatDate);}if(this.byId(p+".NetDueDate")!==undefined){this.byId(p+".NetDueDate").setGroupHeaderFormatter(this._formatDate);}},_setDefaultOperationOfDateRangeType:function(c){if(c.getFiscalYearVariant()!==""){c.setOperation("FISCAL_YEAR_TO_DATE");}else{c.setOperation("YEARTODATE");}c.getModel().checkUpdate(true);},_initializeOperationOfDateRangeType:function(c){c.setOperation("YEARTODATE");c.setOperation("DATERANGE");c.getModel().checkUpdate(true);},onChangeStatus:function(e,p){var s=this.getView().byId("fin.gl.glview.display.smartfilterbar");var P=s.getConditionTypeByKey("PostingDate");var c=s.getConditionTypeByKey("ClearingDate");var f=s.determineFilterItemByName("PostingDate");var o=(e&&e.getSource)?e.getSource():this.getView().byId("fin.gl.glview.display.sfb.SSselect");switch(o.getSelectedKey()){case"DDLB_STATUS_ALL":this.oStatus=new fin.gl.glview.display.util.Status.StatusAll(this);this.getView().byId("fin.gl.glview.display.sfb.XOPVW").setVisible(false);this.getView().byId("fin.gl.glview.display.sfb.KeyDate").setVisible(false);if(f){f.setVisible(true);f.setVisibleInFilterBar(true);}if(!p){f=s.determineFilterItemByName("ClearingDate");if(f){f.setVisible(true);f.setVisibleInFilterBar(false);}this._setDefaultOperationOfDateRangeType(P);this._initializeOperationOfDateRangeType(c);}break;case"DDLB_STATUS_OPEN":this.oStatus=new fin.gl.glview.display.util.Status.StatusOpen(this);this.getView().byId("fin.gl.glview.display.sfb.XOPVW").setVisible(false);this.getView().byId("fin.gl.glview.display.sfb.KeyDate").setVisible(true);if(!p){if(f){f.setVisible(true);f.setVisibleInFilterBar(false);}f=s.determineFilterItemByName("ClearingDate");if(f){f.setVisible(true);f.setVisibleInFilterBar(false);}this._initializeOperationOfDateRangeType(P);this._initializeOperationOfDateRangeType(c);this.getView().byId("fin.gl.glview.display.sfb.KDpicker").setDateValue(new Date());}f=s.determineFilterItemByName("KeyDate");if(f){f.setVisibleInFilterBar(true);}break;case"DDLB_STATUS_CLEARED":this.oStatus=new fin.gl.glview.display.util.Status.StatusCleared(this);this.getView().byId("fin.gl.glview.display.sfb.XOPVW").setVisible(false);this.getView().byId("fin.gl.glview.display.sfb.KeyDate").setVisible(true);if(!p){if(f){f.setVisible(true);f.setVisibleInFilterBar(false);}this._initializeOperationOfDateRangeType(P);this._setDefaultOperationOfDateRangeType(c);this.getView().byId("fin.gl.glview.display.sfb.KDpicker").setValue("");}f=s.determineFilterItemByName("ClearingDate");if(f){f.setVisible(true);f.setVisibleInFilterBar(true);}f=s.determineFilterItemByName("KeyDate");if(f){f.setVisibleInFilterBar(true);}}},onKeyDateChanged:function(e){var k=this.getView().byId("fin.gl.glview.display.sfb.KDpicker");if(!e.getParameter("valid")){if(k.getDateValue()){k.setDateValue(null);}else{k.setDateValue(new Date());k.setDateValue(null);}}},onToggleHeaderPressed:function(e){var p=this.getView().getModel("page");p.setProperty("/headerExpanded",(p.getProperty("/headerExpanded")===true)?false:true);},onMessagePopoverPressed:function(e){this._handleMessaging();if(e===this.getView().byId("fin.gl.glview.display.footer.button.alert")){window.setTimeout(function(){this.oMessagePopover.openBy(e);}.bind(this),500);}else{this.oMessagePopover.openBy(e.getSource());}this.oMessagePopover.attachAfterClose(function(c){this.oMessagePopover.getModel("messaging").getData().splice(0,this.oMessagePopover.getModel("messaging").getData().length);this.oCustomErrorMessages.splice(0,this.oCustomErrorMessages.length);this.getView().getModel("page").setProperty("/numberOfMessages",0);this.bIsPossibleErrorTriggeredByUser=false;}.bind(this));},onAssignedFiltersChanged:function(e){var s=this.byId("fin.gl.glview.display.smartfilterbar");this.byId("fin.gl.glview.display.title.filter.text").setText(s.retrieveFiltersWithValuesAsText());if((s.determineFilterItemByName("ExchangeRateType"))&&(s.determineFilterItemByName("ExchangeRateType").getVisibleInAdvancedArea())&&(this.aExRateSuggestionItems.length<1)&&(!this.bIsExRateRequestTriggered)){this._fillExchangeRateSuggestions(this);this.bIsExRateRequestTriggered=true;}if((s.determineFilterItemByName("DisplayCurrency"))&&(s.determineFilterItemByName("DisplayCurrency").getVisibleInAdvancedArea())&&(this.aDispCurSuggestionItems.length<1)&&(!this.bIsDispCurRequestTriggered)){this._fillDisplayCurrencySuggestions(this);this.bIsDispCurRequestTriggered=true;}},onFilterBarCancel:function(e){},onResetFilterBar:function(e){},onExecuteSearch:function(e){this.byId("fin.gl.glview.display.analyticaltable").setEnableBusyIndicator(true);this.bIsPossibleErrorTriggeredByUser=true;this.bIsSearchValid=true;if(this.oStatus.isValid()){if(!jQuery.sap.getUriParameters().get("responderOn")&&!jQuery.sap.getUriParameters().get("parametersProvided")){if(this.bIsMetadataLoaded&&this.bIsControllerInitialized&&this.bIsFilterBarInitialized&&this.bIsLeadingLedgerFetchedAlready){this.storeCurrentAppState();this.bIsPreviousSearchTriggeredBeforeNavWasEvaluated=false;}else{this.bIsPreviousSearchTriggeredBeforeNavWasEvaluated=true;}}}else{this.bIsSearchValid=false;}},_setSfbDisplayCurrencyFields:function(c,s){var e=this.getView().byId("fin.gl.glview.display.sfb.ExRateDatePicker");e.setDateValue(new Date());this.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput").setValue(c.exRateType);this.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput").setValue(c.dispCur);this.getView().byId("fin.gl.glview.display.sfb.ExpandLevelInput").setSelectedKey(c.expLevel);return;},_setSfbItemStatusFields:function(c,s){this.getView().byId("fin.gl.glview.display.sfb.XOPVWselect").setSelectedKey(c.XOPVWselect);var f=s.determineFilterItemByName("PostingDate");var i="fin.gl.glview.display.sfb.SSselect";switch(c.status){case"Open":this.getView().byId(i).setSelectedKey("DDLB_STATUS_OPEN");this.oStatus=new fin.gl.glview.display.util.Status.StatusOpen(this);this.getView().byId("fin.gl.glview.display.sfb.XOPVW").setVisible(false);this.getView().byId("fin.gl.glview.display.sfb.KeyDate").setVisible(true);if(f&&c.fromDate){f.setVisible(true);f.setVisibleInFilterBar(false);this._initializeOperationOfDateRangeType(s.getConditionTypeByKey("PostingDate"));}f=s.determineFilterItemByName("ClearingDate");if(f&&c.toDate){f.setVisible(true);f.setVisibleInFilterBar(false);this._initializeOperationOfDateRangeType(s.getConditionTypeByKey("ClearingDate"));}f=s.determineFilterItemByName("KeyDate");if(f){f.setVisibleInFilterBar(true);}this.getView().byId("fin.gl.glview.display.sfb.KDpicker").setDateValue(new Date());break;case"Cleared":this.getView().byId(i).setSelectedKey("DDLB_STATUS_CLEARED");this.oStatus=new fin.gl.glview.display.util.Status.StatusCleared(this);this.getView().byId("fin.gl.glview.display.sfb.XOPVW").setVisible(false);this.getView().byId("fin.gl.glview.display.sfb.KeyDate").setVisible(true);if(f&&c.fromDate){f.setVisible(true);f.setVisibleInFilterBar(false);this._initializeOperationOfDateRangeType(s.getConditionTypeByKey("PostingDate"));}f=s.determineFilterItemByName("ClearingDate");if(f&&c.toDate){f.setVisible(true);f.setVisibleInFilterBar(true);this._setDefaultOperationOfDateRangeType(s.getConditionTypeByKey("ClearingDate"));}f=s.determineFilterItemByName("KeyDate");if(f){f.setVisibleInFilterBar(true);}var k=this.getView().byId("fin.gl.glview.display.sfb.KDpicker");if(c.keyDate){k.setDateValue(new Date(c.keyDate));}else{k.setValue("");}break;case"All":this.getView().byId(i).setSelectedKey("DDLB_STATUS_ALL");this.oStatus=new fin.gl.glview.display.util.Status.StatusAll(this);this.getView().byId("fin.gl.glview.display.sfb.XOPVW").setVisible(false);this.getView().byId("fin.gl.glview.display.sfb.KeyDate").setVisible(false);if(f&&c.fromDate){f.setVisible(true);f.setVisibleInFilterBar(true);this._setDefaultOperationOfDateRangeType(s.getConditionTypeByKey("PostingDate"));}f=s.determineFilterItemByName("ClearingDate");if(f&&c.toDate){f.setVisible(true);f.setVisibleInFilterBar(false);this._initializeOperationOfDateRangeType(s.getConditionTypeByKey("ClearingDate"));}}},_setSfbCustomFields:function(c,s){this._setSfbDisplayCurrencyFields(c,s);this._setSfbItemStatusFields(c,s);},onBeforeSFBVariantSave:function(e){var s=this.getView().byId("fin.gl.glview.display.smartfilterbar");var c="";var f=true;var t=true;var k="";var d="";if(e.getParameter("context")==="STANDARD"){var g=this.getView().byId("fin.gl.glview.display.sfb.ExRateDatePicker").getDateValue();var h=this.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput").getValue();var i=this.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput").getValue();var j=this.getView().byId("fin.gl.glview.display.sfb.ExpandLevelInput").getSelectedKey();switch(this.getView().byId("fin.gl.glview.display.sfb.SSselect").getSelectedKey()){case"DDLB_STATUS_ALL":d="All";break;case"DDLB_STATUS_OPEN":d="Open";k=this.getView().byId("fin.gl.glview.display.sfb.KDpicker").getDateValue();break;case"DDLB_STATUS_CLEARED":d="Cleared";k=this.getView().byId("fin.gl.glview.display.sfb.KDpicker").getDateValue();}c={status:d,fromDate:f,toDate:t,keyDate:k,exRateDate:g,exRateType:h,dispCur:i,expLevel:j};}else{c=this.oStatus.getCustomFields();c.expLevel=this.getView().byId("fin.gl.glview.display.sfb.ExpandLevelInput").getSelectedKey();}c.XOPVWselect=this.getView().byId("fin.gl.glview.display.sfb.XOPVWselect").getSelectedKey();s.setFilterData({_CUSTOM:""});s.setFilterData({_CUSTOM:c});},onAfterSFBVariantSave:function(e){this.storeCurrentAppState();},onAfterSFBVariantLoad:function(e){var s=this.getView().byId("fin.gl.glview.display.smartfilterbar");var c={};if(!s.getFilterData().Ledger){this._setDefaultLedgerInUI(this);}if(s.getFilterData()!==null&&s.getFilterData()._CUSTOM&&s.getFilterData()._CUSTOM!=={}){c=s.getFilterData()._CUSTOM;this._setSfbCustomFields(c,s);}if(this.bIsMetadataLoaded&&this.bIsControllerInitialized&&this.bIsFilterBarInitialized&&this.bIsLeadingLedgerFetchedAlready){if(this.bIsSFBTriggeredDueToInitialization===false){this.storeCurrentAppState();}else{this.bIsSFBTriggeredDueToInitialization=false;}}},_handleAssetNavigation:function(B){var f=this.getView().byId("fin.gl.glview.display.analyticaltable.FixedAsset");var m=this.getView().byId("fin.gl.glview.display.analyticaltable.MasterFixedAsset");var p=B.parameters.select.indexOf(",FixedAsset");var P=B.parameters.select.indexOf("FixedAsset");var i=B.parameters.select.indexOf("MasterFixedAsset");if((i!==-1)&&(p===-1)){f.setInResult(true);B.parameters.select=B.parameters.select+",FixedAsset";}else if((i===-1)&&(P!==-1)){m.setInResult(true);B.parameters.select=B.parameters.select+",MasterFixedAsset";}else if((i!==-1)&&(p!==-1)){}else{if(f.getInResult()){f.setInResult(false);}if(m.getInResult()){m.setInResult(false);}}},_handleOrderNavigation:function(B){var o=this.getView().byId("fin.gl.glview.display.analyticaltable.OrderCategory");var p=B.parameters.select.indexOf("OrderID");var P=B.parameters.select.indexOf("OrderCategory");if((p!==-1)&&(P===-1)){o.setInResult(true);B.parameters.select=B.parameters.select+",OrderCategory";}else if((p===-1)&&(P!==-1)){}else if((p!==-1)&&(P!==-1)){}else{if(o.getInResult()){o.setInResult(false);}}},onBeforeRebindTable:function(e){var B=e.getParameter("bindingParams");var t=e.getSource();var c=this.oStatus.getCustomFields();var i=false;var d=false;this.getView().setBusy(false);if(!this.bIsSearchValid){B.preventTableBind=true;}else{var D="EUR";var E="M";var s=encodeURIComponent("2019-01-01T00:00:00");if((B.parameters.select.indexOf("AmountInDisplayCurrency")!==-1)||(B.parameters.select.indexOf("DisplayCurrency")!==-1)||(B.parameters.select.indexOf("ExchangeRateType")!==-1)||(B.parameters.select.indexOf("ExchangeRateDate")!==-1)){if(!c.dispCur||!c.exRateType||!c.exRateDate){B.preventTableBind=true;this.oCustomErrorMessages.push({code:this.textBundle.getText("ER_SEARCH"),type:"Error",message:this.textBundle.getText("ERD1_PARAMS_DC")});this.onMessagePopoverPressed(this.getView().byId("fin.gl.glview.display.footer.button.alert"));i=true;}d=true;}if(!i){if(d){D=c.dispCur;E=c.exRateType;s=encodeURIComponent(this._convToFilterDate(c.exRateDate).substr(0,19));}this._handleAssetNavigation(B);this._handleOrderNavigation(B);var k=encodeURIComponent(this._convToFilterDate(new Date()).substr(0,19));var T="0";switch(c.status){case"All":T="1";break;case"Open":k=encodeURIComponent(this._convToFilterDate(c.keyDate).substr(0,19));var f=this.oStatus.getFilters();if(f&&f[0]&&f[0].oValue1==="X"){T="2";}else{T="3";}break;case"Cleared":if(c.keyDate){k=encodeURIComponent(this._convToFilterDate(c.keyDate).substr(0,19));T="4";}else{T="5";}}t.setShowRowCount(false);if(!this.bIsInitialSearchTriggered){this.bIsInitialSearchTriggered=true;}t.setTableBindingPath("/C_JournalEntryItemBrowser(P_DisplayCurrency='"+D+"',P_ExchangeRateType='"+E+"',P_ExchangeRateDate=datetime'"+s+"',P_KeyDate=datetime'"+k+"',P_ClearingStatusSelection='"+T+"')/Results");}}},onBeforeExport:function(e){var E=e.getParameter("exportSettings");if(E.workbook&&E.workbook.columns){E.workbook.columns.some(function(c){if(c.property==="AmountInTransactionCrcy"){c.unitProperty="TransactionCurrency";c.displayUnit=true;c.type="currency";}});}E.dataSource.sizeLimit=5000;},onAfterTableVariantSave:function(e){this.storeCurrentAppState();},onAfterApplyTableVariant:function(e){if(this.bIsMetadataLoaded&&this.bIsControllerInitialized&&this.bIsFilterBarInitialized&&this.bIsLeadingLedgerFetchedAlready){if(this.bIsSTBTriggeredDueToInitialization===false){this.storeCurrentAppState();}else{this.bIsSTBTriggeredDueToInitialization=false;}}},onBeforePopoverOpens:function(e){var s=e.getParameters();var c=this.getView().byId("fin.gl.glview.display.smartfilterbar").getDataSuiteFormat();c=JSON.stringify(this._formatSelectionVariant(JSON.parse(c)));var o=new a(c);var d=false;if(s.semanticObject==="AccountingDocument"&&s.originalId.indexOf("Clearing")!==-1){if((s.originalId.indexOf("ClearingDocFiscalYear")!==-1)&&s.semanticAttributes.ClearingDocFiscalYear&&(s.semanticAttributes.ClearingDocFiscalYear==="0000")){d=true;}var f=o.getSelectOptionsPropertyNames().length-1;for(var i=f;i>-1;i--){o.removeSelectOption(o.getSelectOptionsPropertyNames()[i]);}f=o.getParameterNames().length-1;for(var n=f;n>-1;n--){o.removeParameter(o.getParameterNames()[n]);}c=o.toJSONString();var g=s.semanticAttributes;var h={};for(var k in g){if(k==="Ledger"||k==="CompanyCode"||k==="ChartOfAccounts"||k==="GLAccount"||k==="AccountingDocument"){h[k]=g[k];}else if(k==="ClearingDocFiscalYear"){h.FiscalYear=g.ClearingDocFiscalYear;}}if(g.ClearingAccountingDocument){h.AccountingDocument=g.ClearingAccountingDocument;}e.getParameters().semanticAttributes=h;}if(!d){this.oNavigationHandler.processBeforeSmartLinkPopoverOpens(e.getParameters(),c);}else{M.show(this.textBundle.getText("SLIB_CONT"),{icon:M.Icon.INFORMATION,title:this.textBundle.getText("SLIB_HEADER")});}},_handleUseCaseInit:function(p,k,s){var o=s;var c=false;for(var i=0;i<o.getSelectOptionsPropertyNames().length;i++){if(o.getSelectOptionsPropertyNames()[i]===k){c=true;break;}}if(c){o.removeSelectOption(k);}o.addParameter(k,p[k].toString());return o;},_handleUseCaseA:function(l,p,k,s,i){var o=s;var c=i;switch(l){case"/AlternativeGLAccount":if(k==="AlternativeGLAccount"){o.addParameter("GLAccount",p.AlternativeGLAccount.toString());c=true;}break;case"/CountryChartOfAccounts":if(k==="CountryChartOfAccounts"){o.addParameter("ChartOfAccounts",p.CountryChartOfAccounts.toString());c=true;}break;case"/OffsettingAccount":if(k==="OffsettingAccount"){o.addParameter("GLAccount",p.OffsettingAccount.toString());c=true;}break;case"/PartnerCompanyCode":if(k==="PartnerCompanyCode"){o.addParameter("CompanyCode",p.PartnerCompanyCode.toString());c=true;}break;case"/PartnerProfitCenter":if(k==="PartnerProfitCenter"){o.addParameter("ProfitCenter",p.PartnerProfitCenter.toString());c=true;}break;case"/PartnerFunctionalArea":if(k==="PartnerFunctionalArea"){o.addParameter("FunctionalArea",p.PartnerFunctionalArea.toString());c=true;}break;case"/PartnerBusinessArea":if(k==="PartnerBusinessArea"){o.addParameter("BusinessArea",p.PartnerBusinessArea.toString());c=true;}break;case"/PartnerSegment":if(k==="PartnerSegment"){o.addParameter("Segment",p.PartnerSegment.toString());c=true;}break;case"/PartnerCostCenter":if(k==="PartnerCostCenter"){o.addParameter("CostCenter",p.PartnerCostCenter.toString());c=true;}break;case"/PartnerOrder":if(k==="PartnerOrder"){o.addParameter("OrderID",p.PartnerOrder.toString());c=true;}}return{oSelectionVariant:o,bIsWorkDone:c};},_handleUseCaseB:function(p,k,s){var o=s;if(k==="ClearingAccountingDocument"){o.addParameter("AccountingDocument",p.ClearingAccountingDocument.toString());}else if(k==="ClearingDocFiscalYear"){o.addParameter("FiscalYear",p.ClearingDocFiscalYear.toString());}else if(k==="Ledger"||k==="CompanyCode"||k==="ChartOfAccounts"||k==="GLAccount"){o.addParameter(k,p[k].toString());}return o;},_handlePopUpData:function(p,u,s,l){var o=s;var i=false;for(var k in p){if((k.indexOf("_metadata")===-1)&&(k.indexOf("ID")===-1)&&(k.indexOf("to_")===-1)&&(k.indexOf("Amount")===-1)&&(k.indexOf("Quantity")===-1)&&(k.indexOf("Currency")===-1)&&(k.indexOf("Parameters")===-1)&&(k.indexOf("Crcy")===-1)&&(p[k]!=="")&&(p[k]!==null)&&(p[k]!==false)&&(p[k]!==true)){switch(u){case"Init":o=this._handleUseCaseInit(p,k,o);break;case"A":var r=this._handleUseCaseA(l,p,k,o,i);o=r.oSelectionVariant;i=r.bIsWorkDone;break;case"B":o=this._handleUseCaseB(p,k,o);}if(i){break;}}}return o;},_formatSelectionVariant:function(o){var O=o;var p=0;if(O.Parameters){p=O.Parameters.length;}var s=0;if(O.SelectOptions){s=O.SelectOptions.length;}for(var j=0;j<p;j++){if(O.Parameters[j].PropertyValue===null){O.Parameters[j].PropertyValue="";}}for(var m=0;m<s;m++){if(O.SelectOptions[m].PropertyValue===null){O.SelectOptions[m].PropertyValue="";}}return O;},onBeforePopoverOpens4RDP:function(e){var p=this.oRowDetailsPopover.getModel("RowDetails");var P=p.getData();var s=this.getView().byId("fin.gl.glview.display.smartfilterbar").getDataSuiteFormat();s=JSON.stringify(this._formatSelectionVariant(JSON.parse(s)));var o=new a(s);var c=false;var l=e.getSource().getFieldName();var u="Init";switch(l){case"/AlternativeGLAccount":u="A";break;case"/CountryChartOfAccounts":u="A";break;case"/OffsettingAccount":u="A";break;case"/PartnerCompanyCode":u="A";break;case"/PartnerProfitCenter":u="A";break;case"/PartnerFunctionalArea":u="A";break;case"/PartnerBusinessArea":u="A";break;case"/PartnerSegment":u="A";break;case"/PartnerCostCenter":u="A";break;case"/PartnerOrder":u="A";break;case"/ClearingAccountingDocument":u="B";break;case"/ClearingDocFiscalYear":u="B";if(P.ClearingDocFiscalYear&&P.ClearingDocFiscalYear==="0000"){c=true;}}if(u==="A"||u==="B"){var d=o.getSelectOptionsPropertyNames().length-1;for(var i=d;i>-1;i--){o.removeSelectOption(o.getSelectOptionsPropertyNames()[i]);}d=o.getParameterNames().length-1;for(var n=d;n>-1;n--){o.removeParameter(o.getParameterNames()[n]);}}var f=e.getParameters();if(l==="/AccountingDocCreatedByUser"){s=o.toJSONString();this.oNavigationHandler.processBeforeSmartLinkPopoverOpens(f,s);}else{f.semanticAttributes=null;f.semanticAttributesOfSemanticObjects=null;s=this._handlePopUpData(P,u,o,l).toJSONString();if(!c){this.oNavigationHandler.processBeforeSmartLinkPopoverOpens(f,s);}else{M.show(this.textBundle.getText("SLIB_CONT"),{icon:M.Icon.INFORMATION,title:this.textBundle.getText("SLIB_HEADER")});}}},onPopoverLinkPressed:function(e){this.storeCurrentAppState();},onPrefetchNavTargets:function(e){this.semanticObjects=e.getParameter("semanticObjects");},onNavTargetsObtained:function(e){e.getParameter("show")();},onPressRowDetailsPopover:function(e,i,B){if(!this.oRowDetailsPopover){this.oRowDetailsPopover=sap.ui.xmlfragment("Popover","fin.gl.glview.display/view/RowDetailsPopover",this);this.getView().addDependent(this.oRowDetailsPopover);}var c="";if(i){c=e;}else{c=e.getSource().getBindingContext();}var l=this.getView().byId("fin.gl.glview.display.smartfilterbar").getFilterData().Ledger;var s=c.getProperty("SourceLedger");var d=c.getProperty("CompanyCode");var g=c.getProperty("GLAccount");var A=c.getProperty("AccountingDocument");var f=c.getProperty("AccountingDocumentItem");var h=c.getProperty("LedgerGLLineItem");var j=c.getProperty("FiscalYear");var k=c.getProperty("LedgerFiscalYear");var m="Ledger eq '"+l+"'"+"and SourceLedger eq '"+s+"'"+"and CompanyCode eq '"+d+"'"+"and GLAccount eq '"+g+"'"+"and AccountingDocument eq '"+A+"'"+"and AccountingDocumentItem eq '"+f+"'"+"and LedgerGLLineItem eq '"+h+"'"+"and FiscalYear eq '"+j+"'"+"and LedgerFiscalYear eq '"+k+"'";var t=c.getModel();var o="";if(i){o=B;}else{o=e.getSource();}this.getView().setBusy(true);var D="EUR";if(c.getProperty("CompanyCodeCurrency")){D=c.getProperty("CompanyCodeCurrency");}var E="M";var n=encodeURIComponent(this._convToFilterDate(new Date()).substr(0,19));var K=encodeURIComponent(this._convToFilterDate(new Date()).substr(0,19));var T="1";var u={"$filter":m};if(jQuery.sap.getUriParameters().get("responderOn")||jQuery.sap.getUriParameters().get("parametersProvided")){n=encodeURIComponent("2019-01-01T00:00:00");K=encodeURIComponent("2017-12-06T00:00:00");T="2";u={};}var p="/C_JournalEntryItemBrowser(P_DisplayCurrency='"+D+"',P_ExchangeRateType='"+E+"',P_ExchangeRateDate=datetime'"+n+"',P_KeyDate=datetime'"+K+"',P_ClearingStatusSelection='"+T+"')/Results";t.read(p,{urlParameters:u,success:function(q,r,v){this.getView().setBusy(false);this.oRowDetailsPopover.setModel(this.getView().getModel("i18n"),"i18n");var R=new J();R.setJSON(JSON.stringify(q.results[0]));this.oRowDetailsPopover.setModel(R,"RowDetails");if(i){this.oRowDetailsPopover.setPlacement("Left");}else{this.oRowDetailsPopover.setPlacement("Right");}this.oRowDetailsPopover.setBindingContext(c);this.oRowDetailsPopover.openBy(o);}.bind(this),error:function(q){this.getView().setBusy(false);}.bind(this)});},onRowSelectionChange:function(e){this._setDetailsButttonEnablement(e.getSource(),e);},_setDetailsButttonEnablement:function(t,e){var d=this.getView().byId("fin.gl.glview.display.tb.Details");if(t.getSelectedIndices().length>0){d.setEnabled(true);if(e){this.oRowContext=e.getParameter("rowContext");}}else{d.setEnabled(false);this.oRowContext="";}},onDetailsPressed:function(e){if(this.oRowContext!==""){this.onPressRowDetailsPopover(this.oRowContext,true,this.getView().byId("fin.gl.glview.display.tb.Details"));}},onTitleSharePressed:function(e){if(!this.oShareActionSheet){this.oShareActionSheet=sap.ui.xmlfragment(this.getView().getId(),"fin.gl.glview.display.view.ShareActionSheet",this);this.getView().addDependent(this.oShareActionSheet);}var s=new J();this.getView().setModel(s,"share");this.oShareActionSheet.setModel(s,"share");s.setProperty("/emailButtonText",this.textBundle.getText("SHARE_EMAIL"));s.setProperty("/jamButtonText",this.textBundle.getText("SHARE_JAM"));s.setProperty("/bookmarkButtonText",this.textBundle.getText("SHARE_TILE"));var g=jQuery.sap.getObject("sap.ushell.Container.getUser");s.setProperty("/jamVisible",!!g&&g().isJamActive());this.oShareActionSheet.openBy(this.getView().byId("fin.gl.glview.display.title.button.share"));var B=this.getView().byId("fin.gl.glview.display.share.tile");B.setBeforePressHandler(function(){this.storeCurrentAppState().done(function(){if(!window.hasher){sap.ui.require("sap/ui/thirdparty/hasher");}var h=window.hasher.getHash();var c=h?("#"+h):window.location.href;B.setAppData({title:this.textBundle.getText("BOOKMARK_TITLE_NEWII"),icon:"sap-icon://Fiori5/F0706",customUrl:c});}.bind(this));}.bind(this));},onShareEmailPress:function(){this.storeCurrentAppState().done(function(){sap.m.URLHelper.triggerEmail(null,this.textBundle.getText("FULLSCREEN_TITLE_NEWII"),document.URL);}.bind(this));},onShareInJamPress:function(e){this.storeCurrentAppState().done(function(){var s=this.textBundle.getText("SHARE_TEXT_NEW"),c=this.textBundle.getText("SHARE_TITLE_NEWII"),o=sap.ui.getCore().createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:document.URL,display:new sap.m.Label({text:c}),share:s}}});o.open();}.bind(this));},storeCurrentAppState:function(){var s=this.getView().byId("fin.gl.glview.display.smartfilterbar");var o=this.getView().byId("fin.gl.glview.display.smarttable");return this.oNavigationHandler.storeInnerAppState({selectionVariant:this._getCleanSuiteFormat(s),semanticDates:JSON.stringify(s.getUiState().getSemanticDates()),tableVariantId:o.getCurrentVariantId(),customData:this.getCustomAppStateData(s)});},_getCleanSuiteFormat:function(s){var d=s.getUiState().getSelectionVariant();var c=-1;var e=-1;if(d.Parameters){c=d.Parameters.length-1;}if(d.SelectOptions){e=d.SelectOptions.length-1;}for(var i=c;i>-1;i--){var p=d.Parameters[i].PropertyName;if(p==="fromDate"||p==="toDate"||p==="keyDate"||p==="exRateDate"||p==="expLevel"||p==="exRateType"||p==="dispCur"||p==="status"||p==="XOPVWselect"||p==="DisplayCurrency"){d.Parameters.splice(i,1);}}for(var x=e;x>-1;x--){var P=d.SelectOptions[x].PropertyName;if(P==="fromDate"||P==="toDate"||P==="keyDate"||P==="exRateDate"||P==="expLevel"||P==="exRateType"||P==="dispCur"||P==="status"||P==="XOPVWselect"||P==="DisplayCurrency"){d.SelectOptions.splice(x,1);}}return JSON.stringify(d);},getCustomAppStateData:function(s){var o=this.getView().byId("fin.gl.glview.display.smarttable");var t=this.getView().byId("fin.gl.glview.display.smarttable-variant");var i=false;if(t&&t.currentVariantGetModified()){i=true;}var c={ItemStatus:this.oStatus.getCustomFields().status,SmartTableState:{tableSelectionVariant:JSON.stringify(o.getUiState().getSelectionVariant()),tablePresentationVariant:JSON.stringify(o.getUiState().getPresentationVariant()),isTableVariantDirty:i}};if(this.isFieldInFilterItems(s,"KeyDate")){c.KeyDate=this.getView().byId("fin.gl.glview.display.sfb.KDpicker").getValue();}if(this.isFieldInFilterItems(s,"DisplayCurrency")){c.DisplayCurrency=this.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput").getValue();}if(this.isFieldInFilterItems(s,"ExchangeRateType")){c.ExchangeRateType=this.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput").getValue();}if(this.isFieldInFilterItems(s,"ExchangeRateDate")){c.ExchangeRateDate=this.getView().byId("fin.gl.glview.display.sfb.ExRateDatePicker").getValue();}if(this.isFieldInFilterItems(s,"LevelSelection")){c.LevelSelection=this.getView().byId("fin.gl.glview.display.sfb.ExpandLevelInput").getSelectedKey();c.LevelVisibility=s.determineFilterItemByName("LevelSelection").getVisibleInAdvancedArea();}if(this.isFieldInFilterItems(s,"IsOpenItemManagedFlag")){c.IsOpenItemManagedFlag=this.getView().byId("fin.gl.glview.display.sfb.XOPVWselect").getSelectedKey();}return c;},isFieldInFilterItems:function(s,f){var c=s.getAllFilterItems(true);for(var i=0;i<c.length;i++){if(c[i].getProperty("name")===f){return true;}}return false;},restoreCustomAppStateData:function(c,s){if(c.DisplayCurrency||c.DisplayCurrency===""){this.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput").setValue(c.DisplayCurrency);s.addFieldToAdvancedArea("DisplayCurrency");}else if(this.isFieldInFilterItems(s,"DisplayCurrency")){this.getView().byId("fin.gl.glview.display.sfb.DisplayCurrencyInput").setValue("");s.determineFilterItemByName("DisplayCurrency").setVisibleInFilterBar(false);s.determineFilterItemByName("DisplayCurrency").setPartOfCurrentVariant(false);}if(c.ExchangeRateType||c.ExchangeRateType===""){this.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput").setValue(c.ExchangeRateType);s.addFieldToAdvancedArea("ExchangeRateType");}else if(this.isFieldInFilterItems(s,"ExchangeRateType")){this.getView().byId("fin.gl.glview.display.sfb.ExRateTypeInput").setValue("M");s.determineFilterItemByName("ExchangeRateType").setVisibleInFilterBar(false);s.determineFilterItemByName("ExchangeRateType").setPartOfCurrentVariant(false);}if(c.ExchangeRateDate||c.ExchangeRateDate===""){this.getView().byId("fin.gl.glview.display.sfb.ExRateDatePicker").setValue(c.ExchangeRateDate);s.addFieldToAdvancedArea("ExchangeRateDate");}else if(this.isFieldInFilterItems(s,"ExchangeRateDate")){this.getView().byId("fin.gl.glview.display.sfb.ExRateDatePicker").setDateValue(new Date());s.determineFilterItemByName("ExchangeRateDate").setVisibleInFilterBar(false);s.determineFilterItemByName("ExchangeRateDate").setPartOfCurrentVariant(false);}if(c.LevelSelection){this.getView().byId("fin.gl.glview.display.sfb.ExpandLevelInput").setSelectedKey(c.LevelSelection);if(c.LevelVisibility){s.addFieldToAdvancedArea("LevelSelection");}}else if(this.isFieldInFilterItems(s,"LevelSelection")){this.getView().byId("fin.gl.glview.display.sfb.ExpandLevelInput").setSelectedKey("L0");s.determineFilterItemByName("LevelSelection").setVisibleInFilterBar(false);s.determineFilterItemByName("LevelSelection").setPartOfCurrentVariant(false);}if(c.IsOpenItemManagedFlag){this.getView().byId("fin.gl.glview.display.sfb.XOPVWselect").setSelectedKey(c.IsOpenItemManagedFlag);}var d="DDLB_STATUS_OPEN";switch(c.ItemStatus){case"Cleared":d="DDLB_STATUS_CLEARED";break;case"All":d="DDLB_STATUS_ALL";break;}this.getView().byId("fin.gl.glview.display.sfb.SSselect").setSelectedKey(d);this.onChangeStatus(null,true);if(c.KeyDate||c.KeyDate===""){this.getView().byId("fin.gl.glview.display.sfb.KDpicker").setValue(c.KeyDate);}return;},_getFilterDataFromNavKeyFormat:function(n){if(!n.oFilterBarFilterData.Ledger||n.oFilterBarFilterData.Ledger===""){n.oFilterBarFilterData.Ledger="";}if(!n.oFilterBarFilterData.Ledger.value){var t=n.oFilterBarFilterData.Ledger;n.oFilterBarFilterData.Ledger={};n.oFilterBarFilterData.Ledger.value=t;}if(n.oFilterBarFilterData.DebitCreditCode&&n.oFilterBarFilterData.DebitCreditCode.value!==""){n.oFilterBarFilterData.DebitCreditCode.items.push({key:n.oFilterBarFilterData.DebitCreditCode.value});n.oFilterBarFilterData.DebitCreditCode.value="";}if(n.oFilterBarFilterData.FunctionalArea&&(n.oFilterBarFilterData.FunctionalArea.value||n.oFilterBarFilterData.FunctionalArea.value===" ")){var f=n.oFilterBarFilterData.FunctionalArea.value;var c={exclude:false,keyField:"FunctionalArea",operation:"EQ",value1:f,value2:null};var i=[];var r=[];r.push(c);var d={items:i,ranges:r};n.oFilterBarFilterData.FunctionalArea=d;}var l="";var h="";if(n.oFilterBarFilterData.LedgerFiscalPeriod&&n.oFilterBarFilterData.LedgerFiscalPeriod.low){if(n.oFilterBarFilterData.LedgerFiscalPeriod.low.length===7){l=n.oFilterBarFilterData.LedgerFiscalPeriod.low.substring(0,3);h=n.oFilterBarFilterData.LedgerFiscalPeriod.low.substring(4);}else{l=n.oFilterBarFilterData.LedgerFiscalPeriod.low.substring(0,3);if(n.oFilterBarFilterData.LedgerFiscalPeriod.high){h=n.oFilterBarFilterData.LedgerFiscalPeriod.high.substring(0,3);}else{h=l;}}var p={exclude:false,keyField:"FiscalPeriod",operation:"BT",value1:l,value2:h};var e={items:[],ranges:[p]};n.oFilterBarFilterData.FiscalPeriod=e;}if(n.oFilterBarFilterData.LedgerFiscalYear){var s=n.oFilterBarFilterData.LedgerFiscalYear;if(s.value){s=s.value;}var o={exclude:false,keyField:"LedgerFiscalYear",operation:"EQ",value1:s.toString(),value2:null};var g={items:[],ranges:[o]};n.oFilterBarFilterData.LedgerFiscalYear=g;}return n.oFilterBarFilterData;}});});
